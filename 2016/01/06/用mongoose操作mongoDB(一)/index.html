<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 用mongoose操作MongoDB(一) · 柠檬时光 Lemon time</title><meta name="description" content="用mongoose操作MongoDB(一) - Ledger.Liang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="柠檬时光 Lemon time"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/Tiramisusie" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">用mongoose操作MongoDB(一)</h1><div class="post-info">Jan 6, 2016</div><div class="post-content"><p>最近在做一个课程设计，想做一个单页应用。但我是学前端的，后端知识比较缺乏，所以有点苦恼后端要怎么实现。正好前阵子看到了一本书，《单页 web 应用 javascript 从前端到后端》(写得挺详细的一本书，推荐一下)，受到了启发，于是决定用 nodejs 做后端。</p>
<a id="more"></a>
<p>这篇文章主要是讲一下在数据库方面的使用。其实我自己对于数据库是不太懂，这次的设计算是我第一次真正意义上的使用数据库，而且还是我自己一步一步摸索（瞎搞）出来的，有不对的地方请多多指教。</p>
<p>数据库我是用 <a href="https://www.mongodb.org/" target="_blank" rel="external">MongoDB</a> 。因为 mongoDB 的存储格式是 JSON ，比较适合单页应用。在 MongoDb 的驱动方面，我选择了一个 ODM( Object Docunemt Mapper) ：<a href="http://mongoosejs.com/" target="_blank" rel="external">mongoose</a>。</p>
<p><strong>注意</strong> 我是用 OSX 的，其他系统的操作可能会有些不同。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="MongoDB-安装"><a href="#MongoDB-安装" class="headerlink" title="MongoDB 安装"></a>MongoDB 安装</h3><p>在 osx 下，推荐用 homebrew 来安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew install mongodb</div></pre></td></tr></table></figure>
<p>如果 homebrew 安装失败的话，可以直接从官网下载对应的二进制文件。</p>
<p>其他平台的安装可以看<a href="https://docs.mongodb.org/manual/installation/" target="_blank" rel="external">官方文档</a>。</p>
<h3 id="mongoose-安装"><a href="#mongoose-安装" class="headerlink" title="mongoose 安装"></a>mongoose 安装</h3><p>mongoose 的安装也非常简单：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install --save mongoose</div></pre></td></tr></table></figure>
<p>安装之前先确保你已经正确安装了 nodejs 。</p>
<h2 id="启动数据库"><a href="#启动数据库" class="headerlink" title="启动数据库"></a>启动数据库</h2><h3 id="默认路径下启动"><a href="#默认路径下启动" class="headerlink" title="默认路径下启动"></a>默认路径下启动</h3><p>启动 MongoDB 最简单的方法就是在命令行输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongod</div></pre></td></tr></table></figure>
<p>这时候，数据库就会在默认的路径 ‘data/db’ 下启动数据库。</p>
<h3 id="特定路径下启动"><a href="#特定路径下启动" class="headerlink" title="特定路径下启动"></a>特定路径下启动</h3><p>如果你想在自己定义的项目目录下启动的话可以这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">//假设你在当前目录下有一个叫做 &apos;test&apos; 的目录</div><div class="line"></div><div class="line">mongod --dbpath test</div></pre></td></tr></table></figure>
<p>如果数据库正确启动了，test 目录里面就会多出一些文件。</p>
<h3 id="特定端口启动"><a href="#特定端口启动" class="headerlink" title="特定端口启动"></a>特定端口启动</h3><p>MongoDB 默认是启动在 27017 端口，如果想用其他端口的话可以这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongod --port 8080</div></pre></td></tr></table></figure>
<p>到这里，你的数据库应该就能成功启动了。如果不行，可能是因为授权的问题，可以参考官方文档，或者 Google 一下。</p>
<h2 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h2><p>在项目目录下新建一个文件 app.js :</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</div><div class="line"></div><div class="line">mongoose.connect(<span class="string">'mongodb://localhost:27017/db/test'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> db = mongoose.connection;</div><div class="line">db.on(<span class="string">'error'</span>, <span class="built_in">console</span>.error.bind(<span class="built_in">console</span>, <span class="string">'connection error:'</span>));</div><div class="line">db.once(<span class="string">'open'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'connect success'</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>然后，在保持数据库启动的状态下，打开一个新的命令窗口，输入命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">node app.js</div></pre></td></tr></table></figure>
<p>这个时候如果连接成功的话就会在命令窗口中显示 ‘connect success’ 这样的字样，表示数据库已经连接成功了。现在我们可以对数据进行 CRUD 操作了。这部分我们下次再讲。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2016/02/19/javascript数组降维/" class="prev">PREV</a><a href="/2015/12/31/osx下显示隐藏文件/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2018 <a href="http://yoursite.com">Ledger.Liang</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p><p>粤ICP备18042433号 粤ICP备18042433号-1</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>