<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> ã€è¯‘ã€‘åºåˆ—åŒ–å¤šä¸ª promise æ“ä½œ Â· Nicong</title><meta name="description" content="ã€è¯‘ã€‘åºåˆ—åŒ–å¤šä¸ª promise æ“ä½œ - Nicong.Liang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="Nicong"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/Tiramisusie" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">ã€è¯‘ã€‘åºåˆ—åŒ–å¤šä¸ª promise æ“ä½œ</h1><div class="post-info">2018å¹´10æœˆ22æ—¥</div><div class="post-content"><blockquote>
<p>åŸæ–‡é“¾æ¥ <a href="https://css-tricks.com/why-using-reduce-to-sequentially-resolve-promises-works/" target="_blank" rel="noopener">https://css-tricks.com/why-using-reduce-to-sequentially-resolve-promises-works/</a></p>
<p>æœ¬æ–‡ç¿»è¯‘è‡ªä¸Šé¢ğŸ‘†çš„æ–‡ç« ã€‚å¹¶æ²¡æœ‰é€å­—é€å¥ç¿»è¯‘ï¼Œçœç•¥äº†ä¸€äº›å¥å­ï¼Œå¹¶åŠ å…¥äº†ä¸€äº›ä¸ªäººçš„ç†è§£ã€‚</p>
</blockquote>
<p>åˆ©ç”¨ promise å¯ä»¥æŠŠå¼‚æ­¥çš„ JavaScript ä»£ç å˜å¾—æ›´åŠ ç®€æ´ã€‚ä½†æœ‰æ—¶å€™ï¼Œä½ ä¼šé‡åˆ°ä¸€äº›å…³äº promise çš„å°æŒ‘æˆ˜ï¼Œä¾‹å¦‚ï¼šå¦‚ä½•æŒ‰é¡ºåºåœ° resolve ä¸€ç³»åˆ—çš„ promise ä»»åŠ¡ï¼Œå¹¶ä¸”æ˜¯ä¸Šä¸€ä¸ªä»»åŠ¡ resolve ä¹‹åå†æ‰§è¡Œä¸‹ä¸€ä¸ªã€‚ä¸€ä¸ªç°å®ä¸­çš„åœºæ™¯å°±æ˜¯æœ‰ä¸€ç³»åˆ— ajax è¯·æ±‚ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªè¯·æ±‚çš„å‚æ•°éƒ½æ˜¯å¦ä¸€ä¸ªè¯·æ±‚çš„è¿”å›å€¼ã€‚</p>
<a id="more"></a>
<p>å¦‚æœä¸ä½¿ç”¨ç¬¬ä¸‰æ–¹åŒ…ï¼ˆä¾‹å¦‚ <a href="https://github.com/caolan/async" target="_blank" rel="noopener">async</a>ï¼‰çš„è¯è¦æ€ä¹ˆå®ç°ï¼Ÿæœ€æ™®éçš„è§£å†³æ–¹æ³•æ˜¯åˆ©ç”¨ <code>Array.prototype.reduce()</code> ã€‚å¯ä»¥å‚è€ƒè¿™ç¯‡<a href="https://css-tricks.com/understanding-the-almighty-reducer/" target="_blank" rel="noopener">æ–‡ç« </a>ã€‚æ€»çš„æ¥è¯´å°±æ˜¯è¾“å…¥ä¸€å †ä¸œè¥¿ï¼Œç„¶åæœ€ç»ˆæŠŠå®ƒä»¬ã€Œå‡å°‘ã€åˆ°ä¸€ä¸ªå€¼ï¼Œå°±åƒè¿™æ ·ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> result = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">5</span>].reduce(<span class="function">(<span class="params">accumulator, item</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> accumulator + item;</span><br><span class="line">&#125;, <span class="number">0</span>); <span class="comment">// &lt;-- Our initial value.</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(result); <span class="comment">// 8</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœæŒ‰ç…§æˆ‘ä»¬çš„ç›®çš„ï¼ŒæŠŠ <code>reduce()</code> ç”¨åœ¨ promise ä¸Šï¼Œå°±ä¼šæ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> userIDs = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">userIDs.reduce( <span class="function">(<span class="params">previousPromise, nextID</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> previousPromise.then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> methodThatReturnsAPromise(nextID);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;, <span class="built_in">Promise</span>.resolve());</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…ä½¿ç”¨ <code>async/await</code>ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> userIDs = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">userIDs.reduce( <span class="keyword">async</span> (previousPromise, nextID) =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> previousPromise;</span><br><span class="line">  <span class="keyword">return</span> methodThatReturnsAPromise(nextID);</span><br><span class="line">&#125;, <span class="built_in">Promise</span>.resolve());</span><br></pre></td></tr></table></figure>
<p>è¿‡å»å¾ˆé•¿ä¸€æ®µæ—¶é—´æˆ‘éƒ½æ˜¯ç›´æ¥æŠŠä»£ç å¤åˆ¶è¿‡æ¥ç”¨ï¼Œå› ä¸ºä¸Šé¢çš„ä»£ç æ˜¯å¯è¡Œçš„ã€‚ä½†è¿™ç¯‡æ–‡ç« æˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹è¿™é‡Œé¢çš„ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>ä¸ºä»€ä¹ˆè¿™ç§å†™æ³•æ˜¯å¯è¡Œçš„ï¼Ÿä¸ºä»€ä¹ˆå¯ä»¥å…ˆ resolve ä¸€ä¸ª promise å†æ‰§è¡Œä¸‹ä¸€ä¸ªï¼Ÿ</li>
<li>ä¸ºä»€ä¹ˆä¸ç”¨ <code>Array</code> çš„å…¶ä»–æ–¹æ³•æ¥å®ç°ï¼Ÿ</li>
</ol>
<h3 id="ä¸ºä»€ä¹ˆè¿™ç§å†™æ³•å¯è¡Œï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¿™ç§å†™æ³•å¯è¡Œï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¿™ç§å†™æ³•å¯è¡Œï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¿™ç§å†™æ³•å¯è¡Œï¼Ÿ</h3><p>é¦–å…ˆï¼Œ<code>reduce()</code> çš„ä¸»è¦ç›®çš„æ˜¯è¦æŠŠä¸€å †ä¸œè¥¿å˜æˆä¸€ä¸ªå€¼ï¼Œè€Œå®ƒå®ç°çš„åŸç†å°±æ˜¯åœ¨æ¯ä¸€æ¬¡å¾ªç¯ä¸­æŠŠä¸Šä¸€æ¬¡çš„ç»“æœå­˜åœ¨ <code>accumulator</code> é‡Œã€‚è€Œ <code>accumulator</code> ä¸ä¸€å®šæ˜¯æ•°å­—ï¼Œå¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ï¼ˆä¾‹å¦‚ä¸€ä¸ª promiseï¼‰ï¼Œç„¶ååœ¨æ¯ä¸€æ¬¡å¾ªç¯çš„ callback ä¸­æŠŠè¿™ä¸ªå€¼ä¼ é€’ä¸‹å»ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸ç®¡ <code>accumulator</code> çš„å€¼æ˜¯ä»€ä¹ˆï¼Œæ¯æ¬¡å¾ªç¯çš„è¡Œä¸ºéƒ½ä¸ä¼šæ”¹å˜ï¼ŒåŒ…æ‹¬æ¯ä¸€æ¬¡å¾ªç¯æ‰§è¡Œçš„æ—¶æœºã€‚</p>
<p>æ”¾åœ¨æˆ‘ä»¬ä¸Šé¢çš„ä¾‹å­æ¥è¯´å°±æ˜¯ï¼Œ<code>reduce()</code> ä¸ä¼šç­‰å¾…ä¸Šä¸€ä¸ª promise resolve ä¹‹åå†ç»§ç»­å¾ªç¯ä¸‹ä¸€ä¸ªå€¼ï¼Œè€Œæ˜¯ä¼šå…ˆå°½å¯èƒ½å¿«çš„éå†å®Œè¿™ä¸ªæ•°ç»„ï¼Œç„¶åå†å»ä¸€ä¸ªä¸€ä¸ªåœ°æ‰§è¡Œ promiseã€‚</p>
<p>è¿™å¯èƒ½å’Œæˆ‘ä»¬ä¸€èˆ¬çš„ç†è§£ä¸å¤ªä¸€æ ·ã€‚<strong>å½“æˆ‘ä»¬ä½¿ç”¨ reduce() æ¥æŒ‰é¡ºåºåœ° resolve ä¸€ç»„ promise çš„æ—¶å€™ï¼Œreduce() çš„å¾ªç¯å¹¶ä¸ä¼šå‡æ…¢ã€‚</strong> å®ƒæ˜¯å®Œå…¨åŒæ­¥æ‰§è¡Œçš„ã€‚</p>
<p>å¯ä»¥é€šè¿‡ä»¥ä¸‹çš„ä¾‹å­çœ‹å‡º promise è¿”å›çš„ callback å¹¶æ²¡æœ‰é˜»å¡å¾ªç¯çš„è¿›è¡Œï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">methodThatReturnsAPromise</span>(<span class="params">nextID</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`Resolve! <span class="subst">$&#123;dayjs().format(<span class="string">'hh:mm:ss'</span>)&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">      resolve();</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].reduce( <span class="function">(<span class="params">accumulatorPromise, nextID</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Loop! <span class="subst">$&#123;dayjs().format(<span class="string">'hh:mm:ss'</span>)&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> accumulatorPromise.then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> methodThatReturnsAPromise(nextID);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;, <span class="built_in">Promise</span>.resolve());</span><br></pre></td></tr></table></figure>
<p>console è¾“å‡ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"Loop! 11:28:06"</span></span><br><span class="line"><span class="string">"Loop! 11:28:06"</span></span><br><span class="line"><span class="string">"Loop! 11:28:06"</span></span><br><span class="line"><span class="string">"Resolve! 11:28:07"</span></span><br><span class="line"><span class="string">"Resolve! 11:28:08"</span></span><br><span class="line"><span class="string">"Resolve! 11:28:09"</span></span><br></pre></td></tr></table></figure>
<p>å‡ ä¸ª promise ç¡®å®æ˜¯æŒ‰é¡ºåº resolveï¼Œä½†å¾ªç¯æœ¬èº«ä¾ç„¶æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œå¿«é€Ÿè€Œç¨³å®šï¼Œæ²¡æœ‰è¢« callback é‡Œçš„å¼‚æ­¥å‡½æ•°æ‰“ä¹±æ­¥ä¼ã€‚çœ‹çœ‹ MDN ä¸Šå¯¹ <code>reduce()</code> çš„ <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce#Polyfill" target="_blank" rel="noopener">polyfill</a> å°±ä¼šæ˜ç™½å…¶ä¸­çš„é“ç†ã€‚å…¶ä¸­çš„åŸç†å°±æ˜¯ï¼Œåœ¨ <code>while</code> å¾ªç¯ä¸€æ¬¡åˆä¸€æ¬¡åœ°è§¦å‘ callback çš„æ—¶å€™å¹¶æ²¡æœ‰ä»»ä½•çš„å¼‚æ­¥è¡Œä¸ºã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (k &lt; len) &#123;</span><br><span class="line">  <span class="keyword">if</span> (k <span class="keyword">in</span> o) &#123;</span><br><span class="line">    value = callback(value, o[k], k, o);</span><br><span class="line">  &#125;</span><br><span class="line">  k++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>çŸ¥é“è¿™ä¸ªåŸç†ä¹‹åï¼Œå†æ¥çœ‹çœ‹ä¸Šé¢ä¾‹å­ä¸­é­”æ³•å‡ºç°çš„åœ°æ–¹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> previousPromise.then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> methodThatReturnsAPromise(nextID)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>æ¯æ¬¡ callback è°ƒç”¨çš„æ—¶å€™ï¼Œéƒ½ä¼šè¿”å›ä¸€ä¸ª promiseï¼ŒåŒæ—¶è¿™ä¸ª promise ä¹Ÿä¼šè¿”å›å¦ä¸€ä¸ª promiseã€‚ç¬¬äºŒä¸ª promise å°±ä¼šæˆä¸ºä¸‹ä¸€æ¬¡å¾ªç¯æ—¶å€™çš„ <code>accumulator</code> ã€‚è™½ç„¶  <code>reduce()</code>  å¹¶ä¸ä¼šç­‰å¾…ä»»ä½•å¼‚æ­¥è°ƒç”¨æ‰§è¡Œå®Œæ¯•ã€‚ä½†å®ƒåœ¨æ¯ä¸€æ¬¡å¾ªç¯çš„æ—¶å€™ï¼Œéƒ½ä¼šæŠŠ callback çš„è¿”å›å€¼åœ¨ä¸‹ä¸€æ¬¡å¾ªç¯ä¸­ä½œä¸ºå‚æ•°ä¼ é€’ç»™åŒæ ·çš„ callbackï¼Œè¿™å°±æ˜¯ <code>reduce()</code> çš„ç‹¬ç‰¹é­…åŠ›ã€‚æœ€ç»ˆï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå¤šä¸ª promise ç©¿æˆä¸€æ¡é“¾ï¼Œä½¿å¾—æ‰€æœ‰ä¸œè¥¿éƒ½å˜å¾—ç®€å•å¹¶ä¸”åºåˆ—åŒ–ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>( <span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// Promise #1</span></span><br><span class="line">  </span><br><span class="line">  resolve();</span><br><span class="line">&#125;).then( <span class="function">(<span class="params">result</span>) =&gt;</span> &#123; </span><br><span class="line">  <span class="comment">// Promise #2</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;).then( <span class="function">(<span class="params">result</span>) =&gt;</span> &#123; </span><br><span class="line">  <span class="comment">// Promise #3</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;); <span class="comment">// ... and so on!</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä¾‹å­ä¹Ÿè¯´æ˜äº†ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½åœ¨æ¯æ¬¡å¾ªç¯ä¸­åªè¿”å›ä¸€ä¸ª<strong>å•ä¸€çš„</strong>ã€<strong>æ–°çš„</strong> promiseã€‚å› ä¸ºå¾ªç¯æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œæ¯ä¸€ä¸ª promise éƒ½ä¼šé©¬ä¸Šæ‰§è¡Œï¼Œè€Œä¸ä¼šç­‰å¾…ä¸Šä¸€ä¸ª promise çš„å®Œæˆã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].reduce( <span class="function">(<span class="params">previousPromise, nextID</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Loop! <span class="subst">$&#123;dayjs().format(<span class="string">'hh:mm:ss'</span>)&#125;</span>`</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`Resolve! <span class="subst">$&#123;dayjs().format(<span class="string">'hh:mm:ss'</span>)&#125;</span>`</span>);</span><br><span class="line">      resolve(nextID);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;, <span class="built_in">Promise</span>.resolve());</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"Loop! 11:31:20"</span></span><br><span class="line"><span class="string">"Loop! 11:31:20"</span></span><br><span class="line"><span class="string">"Loop! 11:31:20"</span></span><br><span class="line"><span class="string">"Resolve! 11:31:21"</span></span><br><span class="line"><span class="string">"Resolve! 11:31:21"</span></span><br><span class="line"><span class="string">"Resolve! 11:31:21"</span></span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆæ˜¯å¦å¯ä»¥åœ¨<strong>æ‰€æœ‰</strong>æ“ä½œéƒ½å®Œæˆä¹‹åå†æ‰§è¡Œå…¶ä»–çš„é€»è¾‘å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">methodThatReturnsAPromise</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`Processing <span class="subst">$&#123;id&#125;</span>`</span>);</span><br><span class="line">      resolve(id);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> result = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].reduce( <span class="function">(<span class="params">accumulatorPromise, nextID</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> accumulatorPromise.then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> methodThatReturnsAPromise(nextID);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;, <span class="built_in">Promise</span>.resolve());</span><br><span class="line"></span><br><span class="line">result.then(<span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Resolution is complete! Let's party."</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ç”±äºåœ¨æˆ‘ä»¬çš„ callback ä¸­è¿”å›çš„æ˜¯ä¸€ä¸² promiseï¼Œæ‰€ä»¥æœ€ç»ˆ <code>reduce()</code> è¿”å›çš„æ˜¯ä¸€ä¸ª promiseã€‚å› æ­¤æˆ‘ä»¬å°±å¯ä»¥åœ¨è¿™ä¹‹ååšä»»ä½•åˆæ³•çš„äº‹æƒ…äº†ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆä¸ç”¨-Array-çš„å…¶ä»–æ–¹æ³•æ¥å®ç°ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä¸ç”¨-Array-çš„å…¶ä»–æ–¹æ³•æ¥å®ç°ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä¸ç”¨ Array çš„å…¶ä»–æ–¹æ³•æ¥å®ç°ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä¸ç”¨ <code>Array</code> çš„å…¶ä»–æ–¹æ³•æ¥å®ç°ï¼Ÿ</h3><p>é¦–å…ˆè¦è®°ä½çš„æ˜¯ï¼Œåœ¨ <code>reduce()</code> é‡Œé¢ï¼Œç¨‹åºä¸ä¼šç­‰å¾…ä¸€ä¸ª callback å®Œæˆä¹‹åå†ç»§ç»­å¾ªç¯ä¸‹ä¸€ä¸ªå€¼ã€‚å®ƒæ˜¯å®ŒæˆåŒæ­¥çš„ã€‚ä¸‹é¢è¿™äº›æ–¹æ³•ä¹Ÿæ˜¯åŒæ ·çš„é“ç†ï¼š</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map#Polyfill" target="_blank" rel="noopener"><code>Array.prototype.map()</code></a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach#Polyfill" target="_blank" rel="noopener"><code>Array.prototype.forEach()</code></a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter#Polyfill" target="_blank" rel="noopener"><code>Array.prototype.filter()</code></a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/some#Polyfill" target="_blank" rel="noopener"><code>Array.prototype.some()</code></a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/every#Polyfill" target="_blank" rel="noopener"><code>Array.prototype.every()</code></a></li>
</ul>
<h5 id="ä½†-reduce-æ˜¯ç‰¹åˆ«çš„"><a href="#ä½†-reduce-æ˜¯ç‰¹åˆ«çš„" class="headerlink" title="ä½† reduce() æ˜¯ç‰¹åˆ«çš„"></a>ä½† reduce() æ˜¯ç‰¹åˆ«çš„</h5><p>ä¹‹æ‰€ä»¥ç”¨ <code>reduce()</code> æ˜¯å› ä¸ºæˆ‘ä»¬å¯ä»¥æŠŠä¸€äº›å€¼åœ¨ä¸‹ä¸€æ¬¡å¾ªç¯ä¸­è¿”å›ç»™åŒæ ·çš„ callback ï¼Œåœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠä¸€ä¸ª promise ä¼ é€’ç»™ä¸‹ä¸€æ¬¡å¾ªç¯äº†ã€‚ä½†å¯¹äºå…¶ä»–æ–¹æ³•ï¼Œéƒ½ä¸å¯ä»¥æŠŠä¸Šä¸€æ¬¡ callback çš„è¿”å›å€¼åœ¨ä¸‹ä¸€æ¬¡å¾ªç¯ä¸­ä¼ é€’ç»™è‡ªèº«ã€‚ç›¸åï¼Œè¿™äº›æ–¹æ³•é‡Œ callback çš„å‚æ•°éƒ½æ˜¯é¢„å…ˆå®šå¥½çš„ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸èƒ½åˆ©ç”¨å®ƒä»¬æ¥åºåˆ—åŒ– promise äº†ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].map(<span class="function">(<span class="params">item, [index, array]</span>) =&gt;</span> [value]);</span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].filter(<span class="function">(<span class="params">item, [index, array]</span>) =&gt;</span> [boolean]);</span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].some(<span class="function">(<span class="params">item, [index, array]</span>) =&gt;</span> [boolean]);</span><br><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].every(<span class="function">(<span class="params">item, [index, array]</span>) =&gt;</span> [boolean]);</span><br></pre></td></tr></table></figure>
</div></article></div></main><footer><div class="paginator"><a href="/2017/07/15/npxä½¿ç”¨ç®€ä»‹/" class="next">ä¸‹ä¸€ç¯‡</a></div><div class="copyright"><p>Â© 2015 - 2018 <a href="http://yoursite.com">Nicong.Liang</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>